---
- name: Audit système simple
  hosts: clients
  gather_facts: yes
  become: yes

  tasks:

    - name: Récupérer les services
      service_facts:

    - name: Récupérer les packages installés
      package_facts:

    - name: Récupérer les ports ouverts
      command: ss -tuln
      register: ports

    - name: Générer un rapport
      copy:
        dest: /tmp/audit_report.txt
        content: |
          === AUDIT SYSTÈME ===

          Hôte : {{ inventory_hostname }}
          OS : {{ ansible_distribution }} {{ ansible_distribution_version }}
          Adresse IP : {{ ansible_default_ipv4.address }}
          Date : {{ ansible_date_time.date }}
          Heure : {{ ansible_date_time.time }}
          Fichier OS : {{ ansible_distribution_file_path }}
          nom os : {{ ansible_distribution }} 
          version de l'os : {{ ansible_distribution_version }}
          la version du noyau Linux : {{ ansible_kernel }}


          --- SERVICES ---
          {{ ansible_facts.services | to_nice_json }}

          --- PACKAGES ---
          {{ ansible_facts.packages | to_nice_json }}

          --- PORTS OUVERTS ---
          {{ ports.stdout }}
